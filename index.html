<!DOCTYPE html>
<html>

<head>
    <title>StudyChatHub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">Study Chat</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <button class="btn btn-outline-danger my-2 my-sm-0 mr-2" onclick="deleteAllChats()">Delete All
                        Chats</button>
                </li>                
                <li class="nav-item">
                    <button class="btn btn-outline-success my-2 my-sm-0" onclick="createGroup()">Create Group</button>
                </li>
                <li class="nav-item">
                    <a href="https://wa.me/919322446537?text=Hi" class="btn btn-outline-primary my-2 my-sm-0">Whatsapp</a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row justify-content-center mt-5">
            <div class="col-sm-10 col-md-8 col-lg-6">
                <div id="messages" class="mb-3"></div>

                <div id="sendMsg" class="bg-light p-3">
                    <div class="input-group">
                        <input type="text" id="msgTxt" class="form-control" placeholder="Enter your message...">
                        <div class="input-group-append">
                            <button class="btn btn-primary" id="msgBtn" onclick="sendMessage()">Send</button>
                        </div>
                    </div>
                </div>

                <!-- Marquee -->
                <marquee behavior="scroll" direction="left" scrollamount="5">
                    Welcome to Study Chat - A platform for collaborative studying!
                </marquee>

                <!-- Related Study Information -->
                <div class="mt-3">
                    <h5>Related Study Information</h5>
                    <p>Explore more about Computer Science at D.Y. Patil Science and Computer Science College, Akurdi.</p>
                    <p>Visit the official website: <a href="https://scs.dpuerp.in" target="_blank">D.Y. Patil Science and Computer Science College</a></p>
                </div>

                <!-- Credit Information -->
                <div class="mt-3 text-muted">
                    <p>Built by Kunal Gaikwad</p>
                    <p>Class: F.Y.Bsc (CS)</p>
                    <p>Collage: D.Y. Patil Science and Computer Science College, Akurdi</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAktHb6SLAb3ekcCWW1spg_lTM6PB3pi4I",
            authDomain: "studychat-dpu.firebaseapp.com",
            projectId: "studychat-dpu",
            storageBucket: "studychat-dpu.appspot.com",
            messagingSenderId: "8208143906",
            appId: "1:8208143906:web:04adfcfc374f53fc9e9c7b"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let sender = sessionStorage.getItem('sender');
        if (!sender) {
            sender = prompt('Please enter your name');
            sessionStorage.setItem('sender', sender);
        }

        // Function to send a message
        function sendMessage() {
            const msgTxt = document.getElementById('msgTxt');
            const msg = msgTxt.value.trim(); 
            if (msg === '') {
                alert('Please enter a message.');
                return;
            }
            const timestamp = new Date().getTime();
            db.ref("messages/" + timestamp).set({
                msg: msg,
                sender: sender
            }).then(() => {
                // Clear input after successful send
                msgTxt.value = "";
            }).catch(error => {
                console.error("Error sending message:", error);
                alert('Failed to send message. Please try again later.');
            });
        }

        // Function to delete a message
        function deleteMessage(key) {
            if (confirm("Are you sure you want to delete this message?")) {
                db.ref("messages/" + key).remove().catch(error => {
                    console.error("Error deleting message:", error);
                    alert('Failed to delete message. Please try again later.');
                });
            }
        }

        // Function to delete all chats
        function deleteAllChats() {
            if (confirm("Are you sure you want to delete all chats?")) {
                db.ref("messages").remove().catch(error => {
                    console.error("Error deleting chats:", error);
                    alert('Failed to delete chats. Please try again later.');
                });
            }
        }

        // Function to create a group chat
        function createGroup() {
            alert('Group chat functionality is under development.');
        }

        // Firebase listener for new messages
        db.ref("messages").on("child_added", function (snapshot) {
            const data = snapshot.val();
            const key = snapshot.key;
            const messages = document.getElementById('messages');

            const messageDiv = document.createElement('div');
            messageDiv.id = key;

            if (data.sender === sender) {
                messageDiv.className = 'outer me';
                messageDiv.innerHTML = `<div class="alert alert-primary" role="alert">You: ${data.msg} <button onclick="deleteMessage('${key}')" class="btn btn-sm btn-danger">DELETE</button></div>`;
            } else {
                messageDiv.className = 'outer notMe';
                messageDiv.innerHTML = `<div class="alert alert-secondary" role="alert">${data.sender}: ${data.msg}</div>`;
            }

            messages.appendChild(messageDiv);

            // Scroll to the bottom
            messages.scrollTop = messages.scrollHeight;
        });

        // Firebase listener for message deletion
        db.ref("messages").on("child_removed", function (snapshot) {
            const key = snapshot.key;
            const messageDiv = document.getElementById(key);
            if (messageDiv) {
                messageDiv.remove();
            }
        });
    </script>
</body>

</html>
